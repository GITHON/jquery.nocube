!function(e,t,n,s){var o=function(e,t){this.$element=e,this.$stageEle=e.find(".nocube-stage"),this.$wrapperEle=e.find(".nocube-wrapper"),this.$pageEle=this.$wrapperEle.children(),this.defaults={stopKey:"Control",zoomPercent:.6,animateTime:.5},this.options=$.extend({},this.defaults,t),this.stopKeyDown=!1,this.startTransform=!1,this.startPointX=0,this.startPointY=0,this.rotateX=0,this.rotateY=0,this.cornerDeg=360/this.$pageEle.length};o.prototype={init:function(){this.$element.css("overflow","hidden").css("cursor","move"),this.$stageEle.width(this.$element.width()).height(this.$element.height());var e=this.$pageEle.length,t=$("<div></div>");for(this.$stageEle.append(t);e--;)t.append("<div></div>")},bindEvents:function(){function e(e){t.$pageEle.each(function(n,s){var o=.5*e*1/Math.tan(Math.PI/180*(180/t.$pageEle.length));$(s).css("transform","rotateX("+-n*t.cornerDeg+"deg) translateZ("+o.toFixed(2)+"px)")})}var t=this;t.$element.bind("mousedown",function(n){t.stopKeyDown||(t.startTransform=!0,t.$stageEle.css("transition","none"),t.$wrapperEle.css("transition","none"),t.$stageEle.width(t.$element.width()*t.options.zoomPercent).height(t.$element.height()*t.options.zoomPercent).addClass("nocube-stage-perspective").css("margin","10% auto"),e(t.$element.height()*t.options.zoomPercent),t.startPointX=n.screenX,t.startPointY=n.screenY)}).bind("mousemove",function(e){if(t.startTransform){var n=e.screenY-t.startPointY,s=e.screenX-t.startPointX,o=t.rotateX-n/2;t.$wrapperEle.css("transform","rotateY("+s/20+"deg) rotateX("+o+"deg) ")}}).bind("mouseup",function(n){if(t.startTransform){t.startTransform=!1,t.$wrapperEle.css("transition","all ease-in-out .5s"),t.$stageEle.css("transition","all ease-in-out .5s");var s=(n.screenY-t.startPointY)/2;t.$pageEle.each(function(e,n){if(Math.abs(s)>=Math.abs(e*t.cornerDeg)){if(Math.abs(s)<=Math.abs(e*t.cornerDeg)+Math.abs(t.cornerDeg/2))return s=s>=0?e*t.cornerDeg:-e*t.cornerDeg,!1;if(Math.abs(s)>Math.abs(e*t.cornerDeg)+Math.abs(t.cornerDeg/2)&&Math.abs(s)<=Math.abs((e+1)*t.cornerDeg))return s=s>=0?(e+1)*t.cornerDeg:-(e+1)*t.cornerDeg,!1}}),t.rotateX=t.rotateX-s,t.$wrapperEle.css("transform","rotateY(0deg) rotateX("+t.rotateX+"deg)"),setTimeout(function(){t.$stageEle.width(t.$element.width()).height(t.$element.height()).removeClass("nocube-stage-perspective").css("margin","0px auto"),e(t.$element.height())},500)}}),e(t.$element.height())},bindStopEvents:function(){var e=this;$("html").on("keydown",function(t){t.key===e.options.stopKey&&(e.stopKeyDown=!0,ele.css("user-select","text"),ele.css("cursor","text"))}).on("keyup",function(t){t.key===e.options.stopKey&&(e.stopKeyDown=!1,ele.css("user-select","none"),ele.css("cursor","move"))})}},$.fn.nocube=function(e){var t=new o(this,e);t.init(),t.bindEvents()}}($,window,document);